<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YABAI è¦çš®å”®åƒ¹è©¦ç®—å™¨ï¼ˆå¤š SKUï¼‰</title>
  <style>
    :root { --accent: linear-gradient(45deg,#ff6b35,#f7931e); --card-bg: linear-gradient(45deg,#e8f5e8,#d4edda); }
    body { font-family: Arial, Helvetica, sans-serif; max-width:1100px; margin:28px auto; padding:18px; background:#f9f9f9; color:#222; }
    h1 { text-align:center; color:#333; margin-bottom:14px; font-size:24px; }
    .grid { display:grid; grid-template-columns:1fr 340px; gap:18px; align-items:start; }
    .panel { background:#fff; padding:20px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; vertical-align:middle; }
    th { font-weight:700; background:#fafafa; font-size:14px; }
    input[type="number"], select, input[type="text"] { 
      width:100%; 
      padding:12px 10px; 
      font-size:16px; 
      border:2px solid #ddd; 
      border-radius:6px; 
      box-sizing:border-box; 
    }
    input[type="number"]:focus, select:focus, input[type="text"]:focus {
      border-color:#ff6b35;
      outline:none;
      box-shadow:0 0 4px rgba(255,107,53,0.3);
    }
    input[type="checkbox"] { width:20px; height:20px; cursor:pointer; }
    .small { width:100%; }
    .actions { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
    button.primary { background:var(--accent); color:#fff; padding:12px 16px; border:none; font-size:15px; border-radius:8px; cursor:pointer; font-weight:600; }
    button.primary:hover { opacity:0.9; }
    button.ghost { background:transparent; border:1px solid #ddd; padding:10px 12px; border-radius:8px; cursor:pointer; font-size:14px; }
    button.ghost:hover { background:#f5f5f5; }
    .muted { color:#666; font-size:13px; }
    .good { color:green; font-weight:600; } 
    .bad { color:red; font-weight:600; }
    .settings-row { display:flex; gap:16px; margin-bottom:12px; align-items:center; flex-wrap:wrap; }
    .settings-row label { flex:1; font-size:14px; min-width:180px; }
    .setting-input { width:100%; max-width:none; padding:12px 10px; font-size:16px; border:2px solid #ddd; border-radius:6px; }    .total { font-weight:700; font-size:17px; display:flex; justify-content:space-between; padding-top:12px; gap:10px; flex-wrap:wrap; }
    
    /* ===== æ¡Œé¢ç‰ˆ (PC) ===== */
    @media (min-width:1024px) {
      #skuTable { display:table; }
      .sku-row-wrapper { display:none; }
      .table-mode { display:table-row; }
      input[type="number"], select, input[type="text"] { font-size:16px; }
    }
    
    /* ===== å¹³æ¿ / æ‰‹æ©Ÿç‰ˆ ===== */
    @media (max-width:1023px) {
      .grid { grid-template-columns:1fr; }
      .panel { padding:16px; }
      
      /* éš±è—è¡¨æ ¼ï¼Œæ”¹ç”¨å¡ç‰‡å¼ */
      #skuTable { display:none; }
      .sku-row-wrapper { display:block; }
      .table-mode { display:none; }
      
      /* å¡ç‰‡æ¨£å¼ */
      .sku-card {
        background:#f9f9f9;
        border:2px solid #e0e0e0;
        border-radius:8px;
        padding:16px;
        margin-bottom:16px;
      }
      
      .card-field {
        display:flex;
        flex-direction:column;
        margin-bottom:14px;
      }
      
      .card-field label {
        font-weight:600;
        font-size:14px;
        margin-bottom:6px;
        color:#333;
      }
      
      .card-field input[type="text"],
      .card-field input[type="number"],
      .card-field select {
        padding:14px 12px;
        font-size:16px;
      }
      
      .checkbox-row {
        display:flex;
        gap:16px;
        flex-wrap:wrap;
        align-items:center;
        margin-bottom:14px;
      }
      
      .checkbox-field {
        display:flex;
        align-items:center;
        gap:8px;
      }
      
      .checkbox-field input[type="checkbox"] {
        width:24px;
        height:24px;
        cursor:pointer;
      }
      
      .checkbox-field label {
        font-size:15px;
        margin:0;
        cursor:pointer;
      }
      
      .card-actions {
        display:flex;
        gap:8px;
        margin-top:14px;
      }
      
      .card-actions button {
        flex:1;
        padding:12px;
        font-size:14px;
      }
      
      .card-summary {
        background:#e8f5e8;
        padding:12px;
        border-radius:6px;
        margin-top:14px;
        text-align:center;
        font-weight:600;
      }
      
      .card-summary.bad {
        background:#ffe8e8;
      }
      
      input[type="number"], select, input[type="text"] { 
        font-size:16px;
        padding:14px 12px;
      }
      
      .setting-input { 
        max-width:100%;
        padding:12px;
      }
      
      .settings-row label {
        min-width:100%;
      }
    }
    
    /* ===== æ¥µå°è¢å¹• (æ‰‹æ©Ÿ < 480px) ===== */
    @media (max-width:480px) {
      body { padding:12px; margin:16px auto; }
      h1 { font-size:20px; margin-bottom:12px; }
      .panel { padding:14px; }
      .sku-card { padding:12px; }
      input[type="number"], select, input[type="text"] { 
        font-size:16px;
        padding:12px 10px;
      }
      button { font-size:14px; padding:10px 12px; }
      button.primary { padding:10px 14px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ›’ YABAI è¦çš®å”®åƒ¹è©¦ç®—å™¨ï¼ˆå¤š SKUï¼‰</h1>

  <div class="grid">
    <div class="panel" id="skuPanel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div>
          <strong>å•†å“åˆ—è¡¨ï¼ˆSKU / æ‰¹æ¬¡ï¼‰</strong>
          <div class="muted">æ–°å¢å¤šå€‹å•†å“æˆ–æ‰¹æ¬¡ï¼Œç³»çµ±æœƒé¡¯ç¤ºæ¯åˆ—æ˜ç´°èˆ‡åˆè¨ˆã€‚</div>
        </div>
        <div>
          <button id="addRowBtn" class="primary" title="æ–°å¢å•†å“">ï¼‹ æ–°å¢</button>
        </div>
      </div>

      <!-- PC ç‰ˆï¼šè¡¨æ ¼ -->
      <div style="overflow:auto;">
        <table id="skuTable" aria-label="å•†å“æ¸…å–®">
          <thead>
            <tr>
              <th style="width:140px">åç¨±</th>
              <th style="width:95px">æˆæœ¬</th>
              <th style="width:95px">å”®åƒ¹</th>
              <th style="width:85px">æ•¸é‡</th>
              <th style="width:110px">å…é‹</th>
              <th style="width:75px">ä¿ƒéŠ·</th>
              <th style="width:75px">è¦å¹£</th>
              <th style="width:75px">é•·å‚™è²¨</th>
              <th style="width:150px">æ”¶å…¥ / æ‰‹çºŒ / æ·¨åˆ©</th>
              <th style="width:110px">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="skuBody">
            <!-- è¡¨æ ¼è¡Œæ³¨å…¥ -->
          </tbody>
        </table>
      </div>

      <!-- æ‰‹æ©Ÿç‰ˆï¼šå¡ç‰‡ -->
      <div id="skuCardWrapper" class="sku-row-wrapper"></div>

      <div class="total" style="margin-top:16px;">
        <div>åˆè¨ˆ</div>
        <div id="totalsArea" style="display:flex; gap:8px; flex-wrap:wrap;">
          <span id="totalRevenue">$0</span> /
          <span id="totalFees">$0</span> /
          <span id="totalProfit" class="muted">$0</span> /
          <span id="totalMargin">0.0%</span>
        </div>
      </div>

      <div class="actions" style="margin-top:14px;">
        <button id="calcAllBtn" class="primary">ğŸš€ è¨ˆç®—</button>
        <button id="copyAllBtn" class="ghost">ğŸ“‹ è¤‡è£½çµæœ</button>
        <button id="clearBtn" class="ghost">æ¸…é™¤å…¨éƒ¨</button>
      </div>
    </div>

    <div class="panel" id="settingPanel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
        <strong>è¨­å®šé¢æ¿ï¼ˆè²»ç‡ï¼‰</strong>
      </div>
      <div class="muted" style="font-size:12px; margin-bottom:14px;">è®Šæ›´æœƒå³æ™‚å¥—ç”¨ä¸¦å„²å­˜</div>

      <div style="margin-top:12px;">
        <div class="settings-row">
          <label>æˆäº¤æ‰‹çºŒè²»ï¼ˆä¸€èˆ¬ï¼‰<input id="feeBase" class="setting-input" type="number" step="0.001" min="0" /></label>
          <label>æˆäº¤æ‰‹çºŒè²»ï¼ˆä¿ƒéŠ·ï¼‰<input id="feePromo" class="setting-input" type="number" step="0.001" min="0" /></label>
        </div>

        <div class="settings-row">
          <label>è¦å¹£æŠ˜æŠµï¼ˆæ¸›å¹…ï¼‰<input id="feeShrimp" class="setting-input" type="number" step="0.001" min="0" /></label>
          <label>æµæ°´æœå‹™è²»ï¼ˆ%ï¼‰<input id="feeFlow" class="setting-input" type="number" step="0.001" min="0" /></label>
        </div>

        <div class="settings-row">
          <label>ä¿ƒéŠ·é¡å¤–è²»ï¼ˆ%ï¼‰<input id="feePromoExtra" class="setting-input" type="number" step="0.001" min="0" /></label>
          <label>é•·å‚™è²¨è²»ï¼ˆ%ï¼‰<input id="feeLong" class="setting-input" type="number" step="0.001" min="0" /></label>
        </div>

        <div class="muted" style="margin-top:12px; font-size:12px;">å…é‹æ–¹æ¡ˆç‚ºæ¯åˆ—ç¨ç«‹è¨­å®šï¼šæ–¹æ¡ˆä¸€ = 6%ï¼ˆæŒ‰æ”¶å…¥ï¼‰ï¼Œæ–¹æ¡ˆäºŒ = 60å…ƒ/ç­†ã€‚</div>

        <div style="margin-top:14px;">
          <button id="resetSettingsBtn" class="ghost">é‚„åŸé è¨­è²»ç‡</button>
          <button id="saveSettingsBtn" class="primary" style="margin-left:6px;">å„²å­˜è¨­å®š</button>
        </div>
      </div>

      <hr style="margin:14px 0">

      <div>
        <strong>å¿«é€Ÿèªªæ˜</strong>
        <ol class="muted" style="padding-left:16px; margin-top:8px; font-size:13px;">
          <li>æ¯åˆ—å¯è¨­å®šæ˜¯å¦ç‚ºä¿ƒéŠ· / ä½¿ç”¨è¦å¹£ / é•·å‚™è²¨ï¼Œä¸¦é¸æ“‡å…é‹æ–¹å¼ã€‚</li>
          <li>è¨­å®šé¢æ¿è®Šæ›´æœƒå³æ™‚ç”Ÿæ•ˆä¸¦å„²å­˜åœ¨ localStorageã€‚</li>
          <li>æ–°å¢å¤šåˆ—å¾Œå¯ä¸€æ¬¡è¨ˆç®—å…¨éƒ¨åˆè¨ˆï¼Œæˆ–ä½¿ç”¨ã€Œè¤‡è£½çµæœã€å°‡æ˜ç´°è²¼åˆ°æ–‡ä»¶/èŠå¤©ã€‚</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    (function(){
      /* ---------- helpers ---------- */
      function q(id){ return document.getElementById(id); }
      function toNum(v, fallback=0){ const n = Number(v); return Number.isFinite(n) ? n : fallback; }
      function money(n){ return '$' + Math.round(n).toLocaleString(); }
      function pct(n){ return (n*100).toFixed(1) + '%'; }

      /* ---------- localStorage keys & defaults ---------- */
      const LS_KEY = 'yabai:multisku:v1';
      const DEFAULTS = {
        settings: {
          feeBase: 0.06,
          feePromo: 0.075,
          feeShrimp: 0.015,
          feeFlow: 0.025,
          feePromoExtra: 0.02,
          feeLong: 0.03
        },
        rows: [
          { id: genId(), name: 'ç¤ºä¾‹å•†å“ A', cost:500, price:1000, qty:1, freeship:'1', promo:false, shrimp:true, long:false }
        ]
      };

      function genId(){ return 'r' + Math.random().toString(36).slice(2,9); }

      /* ---------- state ---------- */
      let state = loadState();
      let lastResults = { rows: [], totals: {} };

      /* ---------- elements ---------- */
      const skuBody = q('skuBody');
      const skuCardWrapper = q('sku
